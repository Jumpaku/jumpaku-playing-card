// @generated by protoc-gen-restobuf-nestjs v1 with parameter "target=ts,import_extension=js"
// @generated from file api/v1/app/room/play/service.proto (package api.v1.app.room, syntax proto3)
/* eslint-disable */

import { Body, Controller, Delete, Get, Param, Post, Query, Req, Res } from "@nestjs/common";
import { PlayServiceService } from "./PlayService_rb.service";
import { AccessControl } from "../../../../access_control.decorator";
import type { JsonObject, JsonValue } from "@bufbuild/protobuf";
import { fromJson, toJson } from "@bufbuild/protobuf";
import { Request, Response } from "express";
import { AddDeckRequestSchema, AddDeckResponseSchema, CreatePlaceRequestSchema, CreatePlaceResponseSchema, DeletePlaceRequestSchema, DeletePlaceResponseSchema, GetHistoryRequestSchema, GetHistoryResponseSchema, ListPlaceRequestSchema, ListPlaceResponseSchema, MoveCardRequestSchema, MoveCardResponseSchema } from "../service_pb.js";

@Controller() 
export class PlayServiceController {
  constructor(private service: PlayServiceService) {}

  @Get('/api/v1/app/room/:room_id/play/place')
  @AccessControl({
    scopePath: "api.v1.app.room.PlayService.ListPlace",
    require: [
      "play:place",
    ]
  }) 
  async handleListPlace(
    @Param() pathParams: {[key: string]: string},
    @Query() queryParams: {[key: string]: string},
    @Body() body: JsonObject,
    @Req() req: Request,
    @Res({ passthrough: true}) res: Response,
  ): Promise<JsonValue> {
      body ??= {};
    for (const key in queryParams) {
      setMessageField(body, key.split('.'), queryParams[key]);
    }
    setMessageField(body, ["room_id"], pathParams['room_id']);
    const input = fromJson(ListPlaceRequestSchema, body);
    const output = await this.service.handleListPlace(input, req, res);
    return toJson(ListPlaceResponseSchema, output);
  }

  @Post('/api/v1/app/room/:room_id/play/place')
  @AccessControl({
    scopePath: "api.v1.app.room.PlayService.CreatePlace",
    require: [
      "play:place",
    ]
  }) 
  async handleCreatePlace(
    @Param() pathParams: {[key: string]: string},
    @Query() queryParams: {[key: string]: string},
    @Body() body: JsonObject,
    @Req() req: Request,
    @Res({ passthrough: true}) res: Response,
  ): Promise<JsonValue> {
      body ??= {};
    for (const key in queryParams) {
      setMessageField(body, key.split('.'), queryParams[key]);
    }
    setMessageField(body, ["room_id"], pathParams['room_id']);
    const input = fromJson(CreatePlaceRequestSchema, body);
    const output = await this.service.handleCreatePlace(input, req, res);
    return toJson(CreatePlaceResponseSchema, output);
  }

  @Delete('/api/v1/app/room/:room_id/play/place/:place_id')
  @AccessControl({
    scopePath: "api.v1.app.room.PlayService.DeletePlace",
    require: [
      "play:place",
    ]
  }) 
  async handleDeletePlace(
    @Param() pathParams: {[key: string]: string},
    @Query() queryParams: {[key: string]: string},
    @Body() body: JsonObject,
    @Req() req: Request,
    @Res({ passthrough: true}) res: Response,
  ): Promise<JsonValue> {
      body ??= {};
    for (const key in queryParams) {
      setMessageField(body, key.split('.'), queryParams[key]);
    }
    setMessageField(body, ["room_id"], pathParams['room_id']);
    setMessageField(body, ["place_id"], pathParams['place_id']);
    const input = fromJson(DeletePlaceRequestSchema, body);
    const output = await this.service.handleDeletePlace(input, req, res);
    return toJson(DeletePlaceResponseSchema, output);
  }

  @Post('/api/v1/app/room/:room_id/play/place/:place_id/deck')
  @AccessControl({
    scopePath: "api.v1.app.room.PlayService.AddDeck",
    require: [
      "play:card",
    ]
  }) 
  async handleAddDeck(
    @Param() pathParams: {[key: string]: string},
    @Query() queryParams: {[key: string]: string},
    @Body() body: JsonObject,
    @Req() req: Request,
    @Res({ passthrough: true}) res: Response,
  ): Promise<JsonValue> {
      body ??= {};
    for (const key in queryParams) {
      setMessageField(body, key.split('.'), queryParams[key]);
    }
    setMessageField(body, ["room_id"], pathParams['room_id']);
    setMessageField(body, ["place_id"], pathParams['place_id']);
    const input = fromJson(AddDeckRequestSchema, body);
    const output = await this.service.handleAddDeck(input, req, res);
    return toJson(AddDeckResponseSchema, output);
  }

  @Post('/api/v1/app/room/:room_id/play/place/:place_id/card/move')
  @AccessControl({
    scopePath: "api.v1.app.room.PlayService.MoveCard",
    require: [
      "play:card",
    ]
  }) 
  async handleMoveCard(
    @Param() pathParams: {[key: string]: string},
    @Query() queryParams: {[key: string]: string},
    @Body() body: JsonObject,
    @Req() req: Request,
    @Res({ passthrough: true}) res: Response,
  ): Promise<JsonValue> {
      body ??= {};
    for (const key in queryParams) {
      setMessageField(body, key.split('.'), queryParams[key]);
    }
    setMessageField(body, ["room_id"], pathParams['room_id']);
    setMessageField(body, ["place_id"], pathParams['place_id']);
    const input = fromJson(MoveCardRequestSchema, body);
    const output = await this.service.handleMoveCard(input, req, res);
    return toJson(MoveCardResponseSchema, output);
  }

  @Get('/api/v1/app/room/:room_id/play/history')
  @AccessControl({
    scopePath: "api.v1.app.room.PlayService.GetHistory",
    require: [
      "play:card",
    ]
  }) 
  async handleGetHistory(
    @Param() pathParams: {[key: string]: string},
    @Query() queryParams: {[key: string]: string},
    @Body() body: JsonObject,
    @Req() req: Request,
    @Res({ passthrough: true}) res: Response,
  ): Promise<JsonValue> {
      body ??= {};
    for (const key in queryParams) {
      setMessageField(body, key.split('.'), queryParams[key]);
    }
    setMessageField(body, ["room_id"], pathParams['room_id']);
    const input = fromJson(GetHistoryRequestSchema, body);
    const output = await this.service.handleGetHistory(input, req, res);
    return toJson(GetHistoryResponseSchema, output);
  }

}

function setMessageField(message: JsonObject, fieldPath: string[], value: string): JsonValue {
    if(fieldPath.length === 0) {
        throw new Error("fieldPath must not be empty");
    }
    const [field, ...rest] = fieldPath;
    if (fieldPath.length === 1) {
        message[field] = value;
        return message;
    }else {
        message[field] ??= {};
        return setMessageField(message[field] as JsonObject , rest, value);
    }
}
